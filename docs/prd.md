# SPCP 产品需求文档 (PRD)

## 📋 文档信息

- **项目名称**: SPCP - Serverless Project Contribution Platform
- **版本**: v1.1
- **创建日期**: 2025年10月21日
- **最后更新**: 2025年10月26日
- **文档类型**: 产品需求文档

## 🎯 项目概述

### 1.1 项目背景

随着无服务器架构的兴起，传统的中心化协作平台已无法满足分布式团队的需求。SPCP旨在构建一个基于GitHub的无服务器贡献平台，为开源项目提供内容管理和协作功能。

### 1.2 产品定位

SPCP是一个**无服务器贡献平台**，包括桌面版、手机版和网页版。系统采用零运维成本架构，所有业务逻辑在客户端实现，通过GitHub仓库存储所有数据。产品专注于内容创作、版本管理、审核流程和积分奖励机制。

**核心特点**：
- **零运维成本**: 无服务器架构，无需维护，完全serverless
- **零学习成本**: 下载即用，无需学习复杂技术，界面友好直观
- **零门槛参与**: 除了GitHub账号注册外，完全零门槛，任何人都能参与
- **完全透明**: 所有参与者、参与过程、获得的好处全部明文公开
- **全程可追溯**: 每个操作都有完整的记录和审计追踪
- **隐私无关**: 仅适用于不涉及隐私的公开内容项目
- **流畅体验**: 单页应用架构，避免页面刷新和加载时序问题

### 1.3 目标用户

- **开源项目维护者**: 需要透明协作的开源项目负责人
- **内容创作者**: 需要协作创作公开文档、代码、设计的用户
- **项目管理者**: 需要管理团队协作和审核流程的管理者
- **审核人员**: 负责内容质量控制和合并决策的专业团队
- **普通用户**: 希望参与无服务器项目但缺乏技术背景的用户
- **技术小白**: 完全不懂Git、编程等技术的普通用户，只需GitHub账号即可参与

**适用场景**：
- **开源软件开发**: 代码、文档、设计等公开内容，零技术门槛参与
- **知识分享项目**: 教程、指南、百科等教育内容，任何人都能贡献知识
- **创意协作项目**: 艺术、文学、音乐等创作内容，创意无门槛
- **社区建设项目**: 活动策划、社区规则等公开信息，社区成员轻松参与
- **教育协作项目**: 学生、老师、家长等教育相关人员的零门槛协作
- **公益活动项目**: 志愿者、组织者等公益相关人员的简单协作

**不适用场景**：
- **商业机密项目**: 涉及商业机密的内部项目
- **个人隐私内容**: 涉及个人隐私的敏感信息
- **保密项目**: 需要保密协议的项目
- **内部管理系统**: 企业内部管理系统

## 🎯 核心功能需求

### 2.1 多平台支持

#### 2.1.1 桌面应用程序
- **技术要求**: 跨平台桌面应用（Windows、macOS、Linux）
- **技术栈**: Electron + 原生JavaScript
- **安装方式**: 提供安装包下载，支持自动更新
- **性能要求**: 启动时间 < 3秒，内存占用 < 200MB

#### 2.1.2 移动端应用
- **技术要求**: 支持iOS和Android
- **技术栈**: WebView + 原生JavaScript
- **功能**: 基础编辑、查看、审核功能
- **离线支持**: 本地缓存，网络恢复后同步

#### 2.1.3 网页版应用
- **部署方式**: GitHub Pages静态部署
- **技术栈**: 原生JavaScript + PWA
- **功能**: 完整功能支持
- **零运维**: 完全静态，无服务器成本

### 2.2 GitHub集成与封装

#### 2.2.1 版本控制系统
- **底层技术**: 基于GitHub API和Git协议
- **封装程度**: 完全隐藏Git命令，提供图形化界面
- **零学习成本**: 用户无需了解Git、分支、合并等概念，系统自动处理
- **功能支持**: 
  - 自动分支创建和管理（用户无感知）
  - 提交历史可视化（简单易懂的界面）
  - 冲突检测和解决（自动处理）
  - 合并请求(Pull Request)管理（简化为"提交审核"）

#### 2.2.2 仓库管理
- **仓库创建**: 支持创建新仓库和克隆现有仓库
- **权限管理**: 集成GitHub权限系统
- **多仓库支持**: 支持同时管理多个项目仓库

#### 2.2.3 权限保护机制
- **CODEOWNERS机制**: 使用GitHub CODEOWNERS保护敏感文件和目录
- **受保护路径**: POINT目录和角色定义文件（.github/reviewers.txt等）受CODEOWNERS保护
- **自动审查**: 修改受保护文件时必须通过CODEOWNERS审查才能合并
- **权限隔离**: 维护者拥有Write权限，但无法绕过CODEOWNERS机制修改敏感文件

### 2.3 内容管理系统

#### 2.3.1 文件树管理
- **界面设计**: 树形文件浏览器，支持拖拽操作
- **文件类型**: 支持Markdown、文本、图片、代码等多种格式
- **链接系统**: 支持文件间相互链接和引用
- **搜索功能**: 全文搜索，支持正则表达式和过滤器

#### 2.3.2 离线编辑
- **编辑器**: 集成Markdown编辑器，支持实时预览
- **分支编辑**: 所有编辑都在个人分支上进行，不影响主分支
- **离线编辑**: 编辑完成后本地保存，提交审核前其他用户无法看到
- **版本对比**: 可视化显示文件变更历史和审核状态
- **模块状态缓存**: 编辑器页面功能模块（文件信息、编辑历史、协作信息）的显示状态会被自动保存，下次进入时恢复用户的使用偏好
- **自动保存**: 编辑内容自动保存到本地缓存

#### 2.3.3 页面创建
- **模板系统**: 提供多种文档模板
- **快速创建**: 一键创建新页面和文件夹
- **命名规范**: 自动生成文件名，支持自定义命名规则

### 2.4 审核与协作流程

#### 2.4.1 自动分支管理
- **分支策略**: 每个用户编辑自动创建个人分支
- **命名规范**: 分支命名格式：`user/feature/description`
- **生命周期**: 自动管理分支创建、合并、删除

#### 2.4.2 提交审核流程
- **完整流程**: 用户编辑(个人分支) → 提交PR → 等待审核 → 审核通过 → 合并到主分支 → 其他用户可见
- **隔离性**: 编辑内容在个人分支上，其他用户无法看到未审核的内容
- **审核界面**: 提供专业的审核工具和界面，支持代码对比和评论
- **审核标准**: 可配置的内容质量标准和审核规则
- **批量操作**: 支持批量审核和合并操作

#### 2.4.3 审核团队管理
- **角色权限**: 审核员、高级审核员、管理员等角色
- **审核分配**: 支持自动分配和手动分配审核任务
- **审核历史**: 完整的审核决策记录和追溯

### 2.5 讨论与交流系统

#### 2.5.1 GitHub Discussions集成
- **功能说明**: 集成GitHub Discussions功能，为项目参与者提供讨论和交流平台
- **功能特点**:
  - 支持问答、公告、一般讨论等多种讨论类型
  - 支持Markdown格式，完整的内容编辑功能
  - 支持标签分类和筛选
  - 支持评论和回复交互
  - 完整的讨论历史和搜索功能
  - 与GitHub原生界面无缝集成

#### 2.5.2 自动启用机制
- **首次登录检测**: 所有者首次登录时自动检测Discussions功能状态
- **自动启用**: 如果Discussions功能关闭，系统自动启用该功能
- **状态验证**: 启用后验证功能是否正常工作
- **用户提示**: 提供友好的提示信息，告知用户Discussions功能已启用
- **零手动操作**: 完全自动化，无需用户手动配置

#### 2.5.3 讨论类型
- **问答(Q&A)**: 针对特定问题的最佳答案标记机制
- **公告(Announcement)**: 项目公告和重要信息发布
- **一般讨论(General)**: 自由讨论和交流

#### 2.5.4 讨论管理
- **创建讨论**: 支持在桌面应用中直接创建和参与讨论
- **查看讨论**: 查看所有讨论列表和详细信息
- **回复评论**: 支持对讨论进行回复和评论
- **标签管理**: 支持创建和使用标签进行分类
- **搜索过滤**: 支持按标题、内容、标签、作者等进行搜索和过滤

#### 2.5.5 权限控制
- **创建权限**: 根据用户角色控制讨论创建权限
- **编辑权限**: 允许用户编辑自己创建的讨论
- **锁定讨论**: 支持锁定长期讨论，防止误操作
- **删除权限**: 仅管理员可删除讨论

### 2.6 积分奖励系统

#### 2.6.1 积分机制
- **积分类型**: 贡献积分、质量积分、审核积分
- **积分规则**: 可配置的积分计算规则
- **积分等级**: 基于积分的用户等级系统

#### 2.6.2 贡献评估
- **内容贡献**: 根据文件大小、复杂度、原创性计算积分
- **审核贡献**: 根据审核质量和效率给予积分
- **协作贡献**: 根据团队协作和帮助他人给予积分

#### 2.6.3 积分管理
- **积分查询**: 用户可查看个人积分历史和排名，所有积分数据公开可见
- **积分转移**: 支持积分转账和奖励分发，所有转移记录公开可追溯
- **积分兑换**: 可配置的积分兑换机制（如权限升级、特殊功能等）
- **公开透明**: 所有积分变化、奖励发放、兑换记录等完全公开
- **全程可追溯**: 每个积分变化都有详细的时间戳、原因、操作者等记录

### 2.7 用户管理系统

#### 2.7.1 用户注册与认证
- **登录方式**: 用户输入邮箱、用户名、仓库地址和GitHub Personal Access Token
- **身份验证**: 基于GitHub Personal Access Token，验证用户身份和权限
- **用户资料**: 自动同步GitHub用户信息，包括权限级别
- **权限检测**: 自动检测用户对目标仓库的权限（所有者/协作者/访客）
- **权限全选**: 建议用户勾选所有权限选项，简化操作流程
- **零门槛**: 只需GitHub账号和Personal Access Token，无需学习复杂技术

#### 2.7.2 权限管理
- **角色系统**: 所有者、审核委员、协作者、访客四种角色
- **自动工作流**: 所有者登录时自动检查并创建GitHub Actions工作流
- **申请流程**: 访客可申请成为协作者，系统自动处理申请
- **权限控制**: 基于角色的权限控制，不同角色拥有不同功能权限

**角色权限详细说明**：

**所有者（Owner）**：
- 完全控制权限，可管理所有功能
- 自动创建GitHub Actions工作流和CODEOWNERS配置
- 首次登录时自动启用GitHub Discussions功能（如果关闭）
- 管理协作者和审核委员
- 设置项目规则和审核流程
- CODEOWNERS权限：POINT目录和角色定义文件

**审核委员（Reviewer）**：
- 审核和批准代码贡献
- 管理其他协作者
- 参与投票和决策
- 执行代码合并操作
- 管理项目讨论和Issues
- CODEOWNERS权限：POINT目录（用于赋分）

**协作者（Collaborator）/ 维护者（Maintainer）**：
- 提交代码和内容
- 参与项目开发
- 查看项目状态
- 参与讨论
- 可合并PR，但受CODEOWNERS限制

**访客（Visitor）**：
- 查看公开内容
- 申请成为协作者
- 浏览项目信息
- **分组管理**: 支持用户分组和批量权限管理
- **数据存储**: 用户信息和权限以明文形式存储在Git仓库中

#### 2.7.3 协作申请流程
- **登录检测**: 系统根据用户权限自动判断用户角色
- **所有者流程**: 自动检查并创建GitHub Actions工作流，自动启用GitHub Discussions功能，直接进入项目管理
- **协作者流程**: 直接跳转到项目页面，显示项目内容
- **访客流程**: 显示申请按钮，点击后进入智能申请流程
- **智能申请流程**: 
  - **提交申请**: 访客填写申请理由并提交，系统创建GitHub Issue
  - **审核状态显示**: 显示"正在审核中"状态，包含进度条和倒计时
  - **工作流轮询**: 每5秒轮询GitHub Actions工作流执行状态
  - **自动接受邀请**: 工作流完成后自动接受协作者邀请
  - **状态更新**: 申请完成后自动更新用户身份为协作者
  - **UI更新**: 隐藏申请板块，显示成功消息
- **零等待体验**: 整个流程约15-30秒完成，用户无需手动操作

#### 2.7.4 用户行为追踪
- **操作日志**: 记录用户所有操作行为，包括编辑、提交、审核等
- **贡献统计**: 统计用户贡献内容和质量，生成公开的贡献报告
- **活跃度分析**: 分析用户活跃度和参与度，提供透明的参与数据
- **公开透明**: 所有用户数据、操作记录、积分变化等完全公开可见
- **全程可追溯**: 每个操作都有时间戳、操作者、操作内容等完整记录
- **审计追踪**: 支持完整的审计追踪，任何人都可以查看项目历史

## 🔧 技术架构

### 3.1 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    完全无服务器架构                              │
├─────────────────────────────────────────────────────────────────┤
│  客户端层 (多平台)                                               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│  │  桌面应用   │ │  移动应用   │ │  网页应用   │ │  PWA应用    │ │
│  │  (Electron) │ │ (WebView)     │ │ (原生JS)   │ │ (Progressive)│ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  业务逻辑层 (纯客户端)                                          │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│  │  Git操作    │ │  审核流程   │ │  积分系统   │ │  权限控制   │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│  │ Discussions│ │  搜索功能   │ │  用户管理   │                │
│  └─────────────┘ └─────────────┘ └─────────────┘                │
├─────────────────────────────────────────────────────────────────┤
│  数据存储层 (GitHub仓库)                                        │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│  │ GitHub API  │ │  Git仓库    │ │ Discussions│ │  项目文件   │ │
│  │ (认证+数据) │ │ (版本控制)  │ │  讨论数据   │ │ (内容管理)  │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │
│  ┌─────────────┐ ┌─────────────┐                                │
│  │  用户数据   │ │ GitHub Pages│                                │
│  │ (明文存储)  │ │ (静态部署)  │                                │
│  └─────────────┘ └─────────────┘                                │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 技术栈选择

#### 3.2.1 前端技术
- **架构**: 单页应用(SPA) + 完全JS动态生成
- **框架**: 原生JavaScript (ES6+)
- **UI组件**: 原生HTML/CSS/JavaScript动态生成
- **状态管理**: 原生JavaScript类 + localStorage
- **编辑器**: Monaco Editor / CodeMirror
- **路由**: 原生JavaScript路由系统

#### 3.2.2 客户端技术
- **桌面应用**: Electron + 原生JavaScript SPA
- **移动应用**: WebView + 原生JavaScript SPA
- **网页应用**: 原生JavaScript SPA + PWA
- **状态管理**: 原生JavaScript类 + localStorage
- **路由**: 原生JavaScript路由
- **加载策略**: 所有JS在index.html中一次性加载，避免时序问题

#### 3.2.3 集成服务
- **GitHub API**: @octokit/rest.js (官方GitHub REST API客户端)
- **GitHub GraphQL API**: GitHub Discussions使用GraphQL API
- **版本控制**: Git命令行工具
- **认证**: GitHub Personal Access Token
- **部署**: GitHub Pages (网页版)
- **存储**: GitHub仓库 (所有数据)
- **Discussions**: GitHub Discussions API (讨论功能)

**重大技术变更 (2025年10月24日)**:
- **API集成策略**: 完全采用官方@octokit/rest.js库，移除所有自定义GitHub API封装
- **代码简化**: 直接使用Octokit方法调用GitHub API，避免重复造轮子
- **维护性提升**: 自动获得最新API支持，减少维护成本
- **类型安全**: 更好的TypeScript支持和错误处理

### 3.3 数据模型

#### 3.3.1 用户模型 (明文存储在Git仓库，完全公开)
```javascript
User {
  id: string                    // GitHub用户ID
  username: string              // GitHub用户名
  displayName: string           // 显示名称
  email: string                 // GitHub邮箱 (公开可见)
  avatarUrl: string             // 头像URL
  role: 'visitor' | 'applicant' | 'contributor' | 'reviewer' | 'admin'
  groupIds: string[]            // 所属组ID列表
  permissions: string[]         // 具体权限列表
  totalPoints: number           // 总积分 (公开可见)
  joinDate: string              // 加入日期
  lastActiveDate: string        // 最后活跃日期
  applicationHistory: string[]  // 申请历史记录 (公开可见)
  contributionHistory: string[] // 贡献历史记录 (公开可见)
  pointHistory: PointRecord[]   // 积分变化历史 (公开可见)
}
```

#### 3.3.2 项目模型 (明文存储在Git仓库)
```javascript
Project {
  id: string                    // 项目唯一ID
  name: string                  // 项目名称
  description: string           // 项目描述
  githubRepo: string            // GitHub仓库地址
  ownerId: string               // 项目所有者GitHub ID
  contributors: string[]        // 贡献者GitHub ID列表
  reviewers: string[]           // 审核员GitHub ID列表
  settings: {
    allowPublicContribution: boolean    // 是否允许公开贡献
    autoMerge: boolean                  // 是否自动合并
    requiredApprovals: number           // 所需审核数量
    pointRules: PointRule[]             // 积分规则
  }
  createdAt: string             // 创建日期
  updatedAt: string             // 更新日期
}
```

#### 3.3.3 贡献模型 (明文存储在Git仓库)
```javascript
Contribution {
  id: string                    // 贡献唯一ID
  userId: string               // 贡献者GitHub ID
  projectId: string            // 项目ID
  type: 'create' | 'edit' | 'review' | 'merge'
  title: string                // 贡献标题
  description: string          // 贡献描述
  content: string              // 贡献内容
  files: string[]              // 涉及的文件列表
  branch: string               // 分支名称
  prNumber: number             // Pull Request编号
  status: 'pending' | 'approved' | 'rejected' | 'merged'
  points: number               // 获得积分
  reviewers: string[]          // 审核员GitHub ID列表
  reviewComments: ReviewComment[]  // 审核评论
  createdAt: string            // 创建日期
  reviewedAt: string           // 审核日期
  mergedAt: string             // 合并日期
}
```

## 📊 功能优先级

### 4.1 MVP功能（第一版本）
1. ✅ **基础桌面应用**: 跨平台安装和运行
2. ✅ **GitHub集成**: 基本的仓库克隆和同步
3. ✅ **文件树浏览**: 基本的文件查看和编辑
4. ✅ **用户认证**: GitHub账号登录
5. ✅ **简单审核**: 基础的PR审核流程

### 4.2 核心功能（第二版本）
1. ✅ **高级编辑**: 富文本编辑器和实时预览
2. 🔄 **审核系统**: 完整的审核工作流
3. 🔄 **积分系统**: 基础积分计算和显示
4. 🔄 **权限管理**: 角色和权限控制
5. 🔄 **搜索功能**: 全文搜索和过滤
6. ✅ **通用模态框系统**: 可复用的模态框组件，支持输入、确认、信息三种类型
7. ⏳ **GitHub Discussions**: 讨论和交流功能，包括自动启用机制

### 4.3 高级功能（第三版本）
1. ⏳ **协作编辑**: 多人实时协作
2. ⏳ **高级分析**: 贡献统计和数据分析
3. ⏳ **自动化**: 智能审核和自动合并
4. ⏳ **集成扩展**: 第三方工具集成
5. ⏳ **移动端**: 移动设备支持

## 🎯 成功指标

### 5.1 用户体验指标
- **启动时间**: < 3秒
- **响应时间**: < 1秒（本地操作）
- **同步时间**: < 30秒（网络操作）
- **用户满意度**: > 4.5/5.0

### 5.2 功能指标
- **文件编辑成功率**: > 99%
- **审核处理时间**: < 24小时
- **系统可用性**: > 99.5%
- **数据一致性**: 100%

### 5.3 业务指标
- **用户活跃度**: 月活跃用户数
- **内容贡献量**: 日均贡献数量
- **审核效率**: 审核通过率
- **用户留存**: 30天留存率 > 70%

## 🚀 开发计划

### 6.1 第一阶段（1-2个月）- SPA架构重构
- [ ] **SPA架构设计**: 设计单页应用架构和路由系统
- [ ] **应用主入口**: 开发app.js和router.js核心文件
- [ ] **页面组件化**: 将所有HTML页面转换为JS页面组件
- [ ] **状态管理**: 实现全局状态管理和持久化
- [ ] **资源加载优化**: 在index.html中一次性加载所有JS资源

### 6.2 第二阶段（2-3个月）- 核心功能实现
- [x] **GitHub API集成**: 完善GitHub服务集成
- [x] **文件管理功能**: 实现文件树和编辑功能
- [x] **用户认证系统**: 完善用户登录和权限管理
- [x] **主题和国际化**: 实现主题切换和多语言支持
- [x] **通用模态框系统**: 开发可复用的模态框组件，替换所有原生对话框
- [ ] **GitHub Discussions集成**: 实现讨论功能，包括自动启用机制、创建讨论、查看讨论等核心功能

### 6.3 第三阶段（3-4个月）- 高级功能开发
- [ ] **审核工作流**: 实现完整的审核流程
- [ ] **积分系统**: 开发积分计算和显示功能
- [ ] **性能优化**: 优化SPA性能和用户体验
- [ ] **用户测试**: 进行用户测试和反馈收集
- [ ] **正式版本发布**: 发布稳定版本

## 📝 风险评估

### 7.1 技术风险
- **GitHub API限制**: API调用频率和配额限制
- **跨平台兼容性**: 不同操作系统的兼容性问题
- **性能问题**: 大量文件处理时的性能瓶颈

### 7.2 业务风险
- **用户接受度**: 用户对无服务器协作的接受程度
- **竞争压力**: 现有协作平台的竞争
- **合规问题**: 内容审核的法律合规性

### 7.3 缓解措施
- **技术方案**: 采用成熟的技术栈和最佳实践
- **用户调研**: 持续进行用户调研和反馈收集
- **法律咨询**: 咨询专业律师确保合规性

## 📚 参考文献

- [GitHub API Documentation](https://docs.github.com/en/rest)
- [Electron Documentation](https://www.electronjs.org/docs)
- [JavaScript Documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript)
- [Git Documentation](https://git-scm.com/doc)

---

**文档状态**: 草稿  
**下次评审**: 2025年11月1日  
**负责人**: 产品团队  
**审核人**: 技术团队
